@page "/user/edit"
@inject IAccountService AccountService
@inject NavigationManager NavigationManager

<h3>Edit</h3>

<EditForm Model="UserEdit" OnValidSubmit="HandleSubmit">
    <DataAnnotationsValidator/>
    <ErrorMessage Message="@ErrorMessage" />
    <TextInputField Type="password" @bind-Value="UserEdit.Password" Label="New Password" ValidationFor="@(() => UserEdit.Password)"/>
    <SubmitButton IsValid="context.Validate()">Update</SubmitButton>
</EditForm>

@code {
    private UserEditDto UserEdit { get; } = new();
    private string? ErrorMessage { get; set; }

    private async Task HandleSubmit()
    {
        var response = await AccountService.ChangePasswordAsync(UserEdit);

        if (response.IsSuccess)
        {
            NavigationManager.NavigateTo("/");
        }
        else
        {
            ErrorMessage = response.Message
                ?? "Something went wrong";
        }
    }

}